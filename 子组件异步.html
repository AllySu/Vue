<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>vuex</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.js"></script>
    <script src="https://unpkg.com/vuex"></script>
</head>

<body>
    <div id="app">
        <counter></counter>
        <p>
            <button @click="increment">+</button>
            <button @click="reducenum">-</button>
        </p>
    </div>
    <script>
    const store = new Vuex.Store({
        state: {
            count: 0
        },
        mutations: {
            increment(state) {
                state.count++
            },
            reduce(state) {
                state.count -= 10;
            }
        },

        actions: {
            reduceit({ commit, state }) {
                var timer = setInterval(function() { // 多参数异步调用
                    commit('reduce');
                    if (state.count < -90) { clearInterval(timer) };
                }, 100);
            }
        }
    });
    const Counter = {
        template: `<div>{{ count }}</div>`,
        computed: {
            count() { // count在哪里，那么computed就在那里进行计算。
                // console.log(this);
                // console.log(this.$store);
                // console.log(store);
                return this.$store.state.count
            }
        }
    };

    const app = new Vue({
        el: '#app',
        store, // 根组件注册之后，每个子组件都被注入，即子组件this.$store.state.XX即可访问
        methods: {
            increment() {
                store.commit('increment') // 此处提交的是mutation
            },
            reducenum() {
                store.dispatch('reduceit') // 此处触发的是action
            }
        },
        components: { Counter }
    })
    </script>
</body>

</html>
